<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
		<script src="../assets/js/vendors/jquery/jquery-1.11.2.js"></script>
	 	<script src="../assets/js/vendors/jquery/jquery-ui.min.js"></script>
		<script src="../assets/js/ui.js"></script>
		<script src="../assets/js/calendar.js"></script>
		<link rel="stylesheet" href="../assets/css/cloudz.css">
</head>
<body>
<div class="wrapper">
	<header>
		<div class="inhead">
			<h1>
				<a href="/main"><span class="invisible">CLOUDZ CONSOLE</span></a>
			</h1>
		</div>
		<nav>
			<ul class="gnb">
				<li><a href="/main"><span> 액션</span></a></li>
				<li><a href="/trigger"><span>  트리거 설정</span></a></li>
				<li><a href="/monitoring"><span> 모니터링</span></a></li>
				<li><a href="admin.skcc.com:5601"><span> 리포팅</span></a></li>
			</ul>
	  </nav>
	</header>
	<div class="container">
		<div class="utils">
    	<div class="reverse"></div>
    </div>
			<div class="locations-area">
				<div class="breadscrumb">
					<a href="모니터링">모니터링</a>
				</div>
			</div>
				<div class="contents">
					 <div class="inners">
						 <div class="top-area">
					<h2 class="title">모니터링</h2>
					<p>Snapshot 모니터링 페이지 입니다.</p>
				</div>
				<div class="tabs">
					<ul class="tabType1">
						<li><a href="#tabs1-1" class="tab-triggers active"><span>성공여부조회</span></a></li>
						<li><a href="#tabs1-2" class="tab-triggers"><span>API호출건수</span></a></li>
						<li><a href="#tabs1-3" class="tab-triggers"><span>상품호출건수</span></a></li>
						<li><a href="#tabs1-4" class="tab-triggers"><span>오류조회</span></a></li>
					</ul>

					<div id="tabs1-1" class="tab-contents active">
                        <!--  accordion  -->
                        <div class="accordion">
                            <div class="btn-block btn-icons-sm">
                                <span class="title">상품목록</span>
                            </div>
                            <div class="accordion-content">
                                <table class="type-vertical">
                                        <colgroup>
                                            <col style="width:14%">
                                            <col style="width:10%">
																						<col style="width:14%">
                                            <col style="width:14%">
                                            <col style="width:10%">
                                        </colgroup>
                                        <thead>
                                            <tr>
                                                <th><a href="#">상품번호 <i class="fa fa-angle-down" aria-hidden="true"></i></a></th>
                                                <th><a href="#">상품상태<i class="fa fa-angle-down" aria-hidden="true"></i></a></th>
																								<th><a href="#">상품상태코드<i class="fa fa-angle-down" aria-hidden="true"></i></a></th>
                                                <th><a href="#">상품 생성 요청시간<i class="fa fa-angle-down" aria-hidden="true"></i></a></th>
                                                <th><a href="#">상품 삭제 요청시간<i class="fa fa-angle-down" aria-hidden="true"></i></a></th>
                                            </tr>
                                        </thead>
                                        <tbody>
																						<tr>
																								<td>123456789</td>
																								<td>미존재</td>
																								<td>999 auth오류</td>
																								<td>2018-07-10 12:40</td>
																								<td> 	</td>
																						</tr>
                                            <tr>
                                                <td>123456789</td>
                                                <td>생성</td>
																								<td>200 정상생성</td>
                                                <td>2018-07-11 11:30</td>
                                                <td> 	</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!--  //accordion  -->
														<div class="reverse">
																<div class="search-area point-line" style="width:400px;"> <!-- 상황에 따라 넓이 지정  -->
																		<form> <!-- form tag 상황에 맞게 사용  -->
																				<input type="search" class="size-xl" placeholder="상품번호 조회" value="">
																				<button type="button" class="btn-search"><i class="fa fa-search"></i></button>
																		</form>
																</div>
														</div>
                        </div>
							<div id="tabs1-2" class="tab-contents">
		                        <!--  accordion  -->
		                        <div class="accordion">
		                            <div class="btn-block btn-icons-sm">
		                                <span class="title">API호출건수 조회</span>
		                            </div>

		                            <div class="accordion-content">
		                                <table class="type-vertical">
		                                        <colgroup>
		                                            <col style="width:50%">
		                                            <col style="width:50%">
		                                        </colgroup>
		                                        <thead>
		                                            <tr>
		                                                <th>호출API</th>
		                                                <th>API요청건수</th>
		                                            </tr>
		                                        </thead>
		                                        <tbody>
																							<tr>
     																						<td>생성</td>

                                                <td id="create_count"></td>
																								<td> </td>

                                          </tr>
																					<tr>
																							<td>조회</td>
																							<td id="result_count"></td>
																							<td> </td>

																					</tr>
																					<tr>
																							<td>삭제</td>
																							<td id="delete_count"></td>
																							<td> </td>

																					</tr>
                                      </tbody>
		                                    </table>
		                                </div>
		                            </div>
		                            <!--  //accordion  -->
																<form action="" method="post">
																	<div class="center-align">
																	<td>
																		<span class="datepicker">
																			<input type="text" name="startDate"  class="size-lg"  placeholder="YYYY-MM-DD" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="">...</button>
																		</span>
																	</td>
																	<td>
																		<span class="datepicker">
																			<input type="text" name="fromDate"  class="size-lg"  placeholder="YYYY-MM-DD" onclick="fnPopUpCalendar(fromDate,fromDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(fromDate,fromDate,'yyyy-mm-dd');" value="">...</button>
																		</span>
																	</td>
																	</div>
																	<div class="reverse">
																				<button type="summit" class="btn-search" id="search" style="width: 54px;height: 54px;font-size: 18px;color: #fff;background-color: #ea0530;cursor: pointer;"><i class="fa fa-search"></i></button>
																	</div>
																</form>
		                        </div>

									<div id="tabs1-3" class="tab-contents">
				                        <!--  accordion  -->
				                        <div class="accordion">
				                            <div class="btn-block btn-icons-sm">
				                                <span class="title">상품건수 조회</span>
				                            </div>

				                            <div class="accordion-content">
																			<table class="type-vertical">
			                                        <colgroup>
			                                            <col style="width:50%">
			                                            <col style="width:50%">
			                                        </colgroup>
			                                        <thead>
			                                            <tr>
			                                                <th>호출API</th>
			                                                <th>상품요청건수</th>
			                                            </tr>
			                                        </thead>
			                                        <tbody>
			                                            <tr>
			       																						<td>생성</td>
				                                                <td></td>
																												<td> </td>
			                                            </tr>
																									<tr>
																											<td>조회</td>
																											<td>4,100,000</td>
																											<td> </td>
																									</tr>
																									<tr>
																											<td>삭제</td>
																											<td>800,000</td>
																											<td> </td>
																									</tr>
			                                        </tbody>
			                                    </table>
			                                </div>
			                            </div>
			                            <!--  //accordion  -->
																	<div class="center-align">
																	<td>
																		<span class="datepicker">
																			<input type="text" id="startDate"  class="size-lg"  placeholder="YYYY.MM.DD" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="">...</button>
																		</span>

																	<td>
																		<span class="datepicker">
																			<input type="text" id="startDate"  class="size-lg"  placeholder="YYYY.MM.DD" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="">...</button>
																		</span>
																	</td>
																	</div>
				                            <!--  //accordion  -->
																		<div class="reverse">
																						<form> <!-- form tag 상황에 맞게 사용  -->
																								<button type="button" class="btn-search" style="width: 54px;height: 54px;font-size: 18px;color: #fff;background-color: #ea0530;cursor: pointer;"><i class="fa fa-search"></i></button>
																						</form>
																		</div>
				                        </div>
									<div id="tabs1-4" class="tab-contents">
				                        <!--  accordion  -->
				                        <div class="accordion">
				                            <div class="btn-block btn-icons-sm">
				                                <span class="title">오류조회</span>
				                            </div>

				                            <div class="accordion-content">
																			<table class="type-vertical">
			                                        <colgroup>
			                                            <col style="width:50%">
			                                            <col style="width:50%">
			                                        </colgroup>
			                                        <thead>
			                                            <tr>
			                                                <th>오류코드</th>
			                                                <th>에러건수</th>
			                                            </tr>
			                                        </thead>
			                                        <tbody>
			                                            <tr>
			       																						<td>999 auth오류</td>
				                                                <td>3,280</td>
																												<td> </td>
			                                            </tr>
																									<tr>
																											<td>801 Size1000이상</td>
																											<td>332</td>
																											<td> </td>
																										</tr>
																									<tr>
																											<td>901 ProdNo누락</td>
																											<td>2,289</td>
																											<td> </td>
																										</td>
																									</tr>
																									<tr>
																											<td>902 loadTimeout누락</td>
																											<td>321</td>
																											<td> </td>
																										</tr>
																									<tr>
																											<td>903 tileHeight누락</td>
																											<td>221</td>
																											<td> </td>
																									</tr>
																									<tr>
																											<td>904 tileWidth누락</td>
																											<td>5</td>
																											<td> </td>
																											</tr>
																									<tr>
																											<td>906 format누락</td>
																											<td>512</td>
																											<td> </td>
																										</tr>
																									<tr>
																											<td>907 prefix누락</td>
																											<td>231</td>
																											<td> </td>
																											</tr>
																									<tr>
																											<td>908 imgLoc누락</td>
																											<td>65</td>
																											<td> </td>
																										</tr>
																									<tr>
																											<td>909 quality누락</td>
																											<td>40</td>
																											<td> </td>
																										</tr>
																									<tr>
																											<td>910 isLimitTraget누락</td>
																											<td>432</td>
																											<td> </td>
																									</tr>
																									<tr>
																											<td>911 priority누락</td>
																											<td>321</td>
																											<td> </td>
																									</tr>
																									<tr>
																											<td>912 env누락</td>
																											<td>18</td>
																											<td> </td>
																									</tr>

			                                        </tbody>
			                                    </table>
			                                </div>
			                            </div>
			                            <!--  //accordion  -->
																	<div class="center-align">
																	<td>
																		<span class="datepicker">
																			<input type="text" id="startDate"  class="size-lg"  placeholder="YYYY.MM.DD" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="">...</button>
																		</span>

																	<td>
																		<span class="datepicker">
																			<input type="text" id="startDate"  class="size-lg"  placeholder="YYYY.MM.DD" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="" style="width:200px;">
																			<button type="button" class="btn bg-white ui-datepicker-trigger" onclick="fnPopUpCalendar(startDate,startDate,'yyyy-mm-dd');" value="">...</button>
																		</span>
																	</td>
																	</div>
				                            <!--  //accordion  -->
																		<div class="reverse">
																						<form> <!-- form tag 상황에 맞게 사용  -->
																								<button type="button" class="btn-search" style="width: 54px;height: 54px;font-size: 18px;color: #fff;background-color: #ea0530;cursor: pointer;"><i class="fa fa-search"></i></button>
																						</form>
																		</div>
				                        </div>
                        <!-- //tab-contents -->
											</div>

  		</div>


	</div>

</div>
	<!-- /container -->
</div>
<!-- /contents -->
<!-- /wrapper -->
<!-- footer -->
<div class="footer">
	COPYRIGHTⓒ2018 BY SK HOLDINGS CO., LTD. ALL RIGHT RESERVED
</div>
<!-- /footer -->
<!-- script -->

<script type="text/javascript">
function formatDate(date) { var d = new Date(date), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear(); if (month.length < 2) month = '0' + month; if (day.length < 2) day = '0' + day; return [year, month, day].join('-'); }

document.querySelector('#search').addEventListener('click', function(e) {
				e.preventDefault();
	var startDate = document.getElementsByName('startDate')[0].value
	var fromDate = document.getElementsByName('fromDate')[0].value;

	var fd = new Date(fromDate)
	for (var sd = new Date(startDate); sd <= fd; sd.setDate(sd.getDate() + 1)){
		var datefg = formatDate(sd)
		sendAjax('http://localhost:3005/api_create_count', {'datefg' : datefg});
		sendAjax('http://localhost:3005/api_delete_count', {'datefg' : datefg});
		sendAjax('http://localhost:3005/api_result_count', {'datefg' : datefg});
	}

	setTimeout(function() {
		var fd = new Date(fromDate)

		for (var sd = new Date(startDate); sd <= fd; sd.setDate(sd.getDate() + 1)){
				var res = sd.toISOString().slice(0,10).replace(/-/g,"");
				var csum = 0
				var rsum = 0
				var dsum = 0
				csum = csum+parseInt(JSON.stringify($("#create_count").data(res)))
				rsum = rsum+parseInt(JSON.stringify($("#result_count").data(res)))
				dsum = dsum+parseInt(JSON.stringify($("#delete_count").data(res)))

		}
			//$("#create_count").date("sum",sum)
			console.log("csum"+csum)
		$("#create_count").text(csum)
		$("#result_count").text(rsum)
		$("#delete_count").text(dsum)
}, 5000) ;



  // sendAjax('http://localhost:3005/api_result_count', {'startDate' : startDate, 'fromDate' : fromDate});
	// sendAjax('http://localhost:3005/api_delete_count', {'startDate' : startDate, 'fromDate' : fromDate});
							// sendAjax('http://localhost:3005/api_called_count', {'startDate' : startDate, 'fromDate' : fromDate}
							// 			);
})

function savedata(name,key,value){
		if(name=="create"){
			$("#create_count").data(key,value)
			// console.log("creategdgd" + JSON.stringify($("#create_count").data()))
		}else if(name=="delete"){
			$("#delete_count").data(key,value)
			// console.log("deletegdgd" + JSON.stringify($("#delete_count").data()))
		}else if(name=="result"){
			$("#result_count").data(key,value)
			console.log("resultgdgd")
		}
}


function sendAjax(url, data){
	data = JSON.stringify(data);
	var xhr = new XMLHttpRequest();
	xhr.open('POST', url);
	xhr.setRequestHeader('Content-Type', "application/json");
	xhr.send(data);

		xhr.addEventListener('load', function() {
			var result = JSON.parse(xhr.responseText);
			if(result.status==200){
			  savedata(result.api,result.datefg,result.count)
			}
			// var result = JSON.parse(xhr.responseText);
			// var resultDiv = document.querySelector("#create_count")
		  // $("#create_count").data("ccount",parseInt(result.count)+$("create_count").data("ccount") );
			});
			// data(Key)로 저장된 data읽기
			// var name = $("#create_count").data("ccount");
			// console.log(name)
			//
			//
			// $("#create_count").text(name);


			//resultDiv.innerHTML = result.count

				// if(result.ccount){
				// 	var resultDiv = document.querySelector(".create_count");
				// 	resultDiv.innerHTML = result.ccount
				// }else	if(result.scount){
				// 	var resultDiv = document.querySelector(".result_count");
				// 	resultDiv.innerHTML = result.scount
				// }else	if(result.dcount){
				// 	var resultDiv = document.querySelector(".delete_count");
				// 	resultDiv.innerHTML = result.dcount
				// }

	// xhr.addEventListener('load', function() {
	// 	var result = JSON.parse(xhr.responseText);
	// 	console.log(result.count1)
	// 					var resultDiv = document.querySelector(".result");
	//
	//
	// 							resultDiv.innerHTML = result.count
	//
	// });
}
</script>
<!-- /script -->


</body>
</html>
